#!/bin/bash
##----------------------------------------------------##
# runs nek cases every 7400 seconds.
#
# INPUT: $1: case name
#        $2: base folder name
#        $3: case # to start from
##----------------------------------------------------##

case=$1
base=$2
num=$3

echo "##############################################" |& tee -a run.log
echo "##############################################" |& tee -a run.log
echo "##############################################" |& tee -a run.log
echo $(date -R)  |& tee -a run.log
echo "Starting new session in directory $PWD." |& tee -a run.log
echo "Running case $1 starting from $2$3" |& tee -a run.log

num=$((num-1));
iter=0
for iter in {1..5}
do
    name0=$base$num;
    num=$((num+1));
    name1=$base$num;

    echo "#--------------------------------------------#" |& tee -a run.log
    echo "#------------- ITERATION $iter ------------------#" |& tee -a run.log
    echo $(date -R) |& tee -a run.log
    cp -vr $name0 $name1 |& tee -a run.log

    cd  $name1
    rm *.cobaltlog *.error *.output |& tee -a ../run.log
    rm restart0.f00001 |& tee -a ../run.log
    mv smoothWavyWall0.f00002 restart0.f00001 |& tee -a ../run.log
    
    makenek $1 |& tee -a ../run.log
    ./my_nekqsub $1 256 |& tee -a ../run.log

    cd ..
    mail -s "$1 autorun" vpuri3@illinois.edu < ./run.log

    sleep 7400
done